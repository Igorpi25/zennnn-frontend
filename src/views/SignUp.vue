<template>
  <div class="h-screen flex">
    <div
      class="auth-left container h-full flex-shrink-0 hidden sm:flex flex-col bg-gray-700"
    >
      <div class="signup--top flex-grow lg:pl-8">
        <div class="auth-left--bg absolute pointer-events-none bottom-0 left-0 top-0" style="right: 50%" />
        <div class="pt-2 lg:pl-12 pb-12">
          <svg width="113" height="19" viewBox="0 0 113 19" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M93.902 11.5428C95.0845 10.1878 96.1355 8.92025 97.2742 7.65266C99.2011 5.51087 101.172 3.41279 103.449 1.66438C104.15 1.13986 104.894 0.527924 105.902 0.659054C107.303 0.877604 108.266 1.62067 108.836 2.93198C109.011 3.36908 108.967 3.71876 108.661 4.11215C106.734 6.64733 105.113 9.40106 104.281 12.5045C104.194 12.8104 104.15 13.1601 104.15 13.5098C104.15 13.9469 104.456 14.1217 104.85 13.9032C105.332 13.5972 105.814 13.2913 106.208 12.8979C107.697 11.4117 109.142 9.88187 110.587 8.35202C111.025 7.91492 111.288 7.8275 111.682 8.17718C112.164 8.57057 112.295 9.1388 111.989 9.53219C109.931 11.9799 107.916 14.4714 105.332 16.4384C104.544 17.0503 103.624 17.5748 102.661 17.9682C100.821 18.755 99.2449 17.7497 99.0697 15.7827C98.9383 14.1655 99.4639 12.6793 100.033 11.2369C101.128 8.61428 102.573 6.16652 104.15 3.76247C103.493 4.37441 102.792 4.94264 102.179 5.55458C98.8507 8.78912 95.6976 12.2422 92.9386 15.9576C92.5882 16.4384 92.2817 16.9192 92.0189 17.4437C91.581 18.2305 90.8365 18.449 90.0482 17.9682C89.0847 17.3563 88.7781 16.351 88.6906 15.3019C88.6468 14.8211 88.7344 14.3403 88.7344 13.8595C87.8147 14.69 86.9388 15.5642 85.9315 16.3072C85.0995 16.9192 84.1798 17.4874 83.2163 17.9245C81.2894 18.755 79.7128 17.7497 79.5814 15.6516C79.4939 14.078 80.0194 12.6356 80.5887 11.1932C81.6398 8.57057 83.085 6.16652 84.6615 3.76247C84.0046 4.37441 83.3039 4.94264 82.6908 5.55458C79.3625 8.78912 76.2093 12.2422 73.4503 15.9576C73.1 16.4384 72.7934 16.9192 72.5306 17.4437C72.0927 18.2305 71.3482 18.449 70.5599 17.9682C69.5965 17.3563 69.2899 16.351 69.2023 15.3019C69.1585 14.8211 69.2461 14.3403 69.2461 13.8595C68.3264 14.69 67.4505 15.5642 66.4433 16.3072C65.6112 16.9192 64.6915 17.4874 63.7281 17.9245C61.8011 18.755 60.2246 17.706 60.0932 15.6516C60.0056 14.078 60.4873 12.5919 61.1004 11.1932C61.6698 9.92558 62.2829 8.61428 62.9836 7.3904C63.6843 6.16652 64.4726 4.98635 65.1733 3.76247C64.5164 4.37441 63.8157 4.94264 63.2025 5.55458C59.8742 8.78912 56.7211 12.2422 53.962 15.9576C53.6117 16.4384 53.3051 16.9192 53.0424 17.4437C52.6044 18.2305 51.8599 18.449 51.0716 17.9682C50.1082 17.3563 49.8016 16.351 49.714 15.3019C49.6702 14.8211 49.7578 14.384 49.8016 13.7721C49.5389 14.0343 49.3637 14.2092 49.1447 14.4277C47.6995 15.8264 46.2543 17.1814 44.3274 17.9245C42.3129 18.7113 40.7363 17.706 40.6049 15.5642C40.5173 14.0343 41.0428 12.5919 41.6122 11.1932C42.6194 8.7017 43.977 6.38507 45.5098 4.24328C45.5974 4.11215 45.685 3.98102 45.685 3.76247C45.0281 4.37441 44.3274 4.94264 43.7143 5.55458C40.5173 8.78912 37.3642 12.2422 34.6052 15.9576C34.2548 16.4384 33.9482 16.9192 33.6855 17.4437C33.2475 18.2305 32.503 18.449 31.7148 17.9682C30.7513 17.3563 30.4447 16.351 30.4009 15.3019C30.3571 14.7337 30.4885 14.1217 30.5323 13.5098C29.963 13.9906 29.3937 14.4714 28.7806 14.9522C26.8536 16.4384 24.7953 17.706 22.3429 18.0556C21.2918 18.2305 20.1532 18.2305 19.1021 17.9682C16.5621 17.3563 15.2045 15.1271 15.73 12.4608C16.6935 7.47782 19.4087 3.67505 23.7881 1.09615C24.5764 0.615344 25.5836 0.353084 26.5033 0.265664C29.8754 -0.084016 32.0651 2.80085 30.7513 5.90426C29.4813 8.96396 25.4084 11.4991 22.0801 11.1495C21.6422 11.1057 21.248 11.0183 20.7663 10.9309C20.5035 11.7614 20.3721 12.5919 20.5473 13.4661C20.6787 14.1217 21.0728 14.5151 21.7736 14.6463C23.2188 14.9085 24.5326 14.5151 25.8026 13.9469C28.4302 12.723 30.5761 10.9309 32.4155 8.74541C33.2037 7.78379 33.6855 6.5162 34.3862 5.46716C35.3496 4.02473 36.4007 2.5823 37.4518 1.22728C38.0211 0.484214 38.5466 0.440504 39.3787 0.965025C39.6852 1.13986 39.948 1.40212 40.167 1.66438C40.8239 2.40745 40.8239 2.75714 40.2108 3.50021C38.4152 5.90426 36.8824 8.52686 35.6124 11.2369C35.5686 11.2806 35.5686 11.368 35.5248 11.4991C36.7073 10.1441 37.7583 8.87654 38.8969 7.60895C40.8239 5.46716 42.7946 3.36908 45.0719 1.62067C45.7726 1.09615 46.5171 0.484214 47.5243 0.615344C48.9257 0.833894 49.8892 1.57696 50.4585 2.88827C50.6337 3.32537 50.5899 3.67505 50.2834 4.06844C48.3564 6.60362 46.7361 9.35735 45.904 12.4608C45.7726 12.8979 45.7288 13.5972 45.9916 13.8158C46.4295 14.1655 46.9112 13.6409 47.2178 13.335C48.7944 11.8051 50.4147 10.2753 51.9037 8.61428C52.692 7.69637 53.0862 6.47249 53.7869 5.46716C54.7503 3.98102 55.8014 2.5823 56.8962 1.18357C57.4655 0.440504 57.9911 0.396794 58.7794 0.921314C59.0859 1.09615 59.3925 1.35841 59.6552 1.66438C60.3121 2.40745 60.3121 2.71343 59.699 3.50021C57.8159 5.90426 56.3269 8.52686 55.0569 11.2806C55.0131 11.3243 55.0131 11.4117 54.9693 11.5428C56.1517 10.1878 57.2028 8.92025 58.3414 7.65266C60.2684 5.51087 62.2391 3.41279 64.5164 1.66438C65.2171 1.13986 65.9616 0.527924 66.9688 0.659054C68.3702 0.877604 69.3337 1.62067 69.903 2.93198C70.0782 3.36908 70.0344 3.71876 69.7278 4.11215C67.8009 6.64733 66.1805 9.40106 65.3484 12.5045C65.2609 12.8104 65.2171 13.1164 65.2171 13.3787C65.2171 13.9469 65.5236 14.1217 65.9616 13.8158C66.3995 13.5535 66.8374 13.2475 67.1878 12.8979C68.5454 11.5428 69.9468 10.2315 71.173 8.78912C72.0051 7.8275 72.4868 6.55991 73.1875 5.46716C74.151 4.02473 75.202 2.5823 76.2969 1.18357C76.8662 0.440504 77.3917 0.440504 78.18 0.921314C78.4866 1.09615 78.7932 1.35841 79.0559 1.66438C79.7128 2.40745 79.7128 2.71343 79.0997 3.50021C77.2604 5.90426 75.7714 8.52686 74.5014 11.2806C74.4576 11.3243 74.4576 11.4117 74.4576 11.5428C75.7714 10.0567 76.9538 8.57057 78.3114 7.17185C80.107 5.33603 82.0339 3.54392 83.917 1.7518C84.1798 1.48954 84.4864 1.35841 84.7929 1.13986C86.5009 -0.171436 89.0409 1.35841 89.4789 3.15053C89.5664 3.41279 89.4351 3.84989 89.2599 4.06844C87.333 6.64733 85.7126 9.40106 84.8367 12.5045C84.7491 12.7667 84.7053 13.0727 84.7053 13.335C84.6615 13.9469 85.0119 14.1655 85.4936 13.8158C85.9315 13.5535 86.3695 13.2475 86.7636 12.8541C88.0774 11.5428 89.4789 10.2753 90.6613 8.83283C91.4934 7.8275 91.9751 6.55991 92.7196 5.46716C93.6831 4.02473 94.7341 2.5823 95.829 1.18357C96.3983 0.440504 96.9238 0.396794 97.7121 0.921314C98.0187 1.09615 98.3252 1.35841 98.588 1.66438C99.2449 2.40745 99.2449 2.75714 98.6318 3.50021C96.7924 5.90426 95.3034 8.52686 94.0334 11.2369C93.9458 11.3243 93.902 11.4117 93.902 11.5428ZM21.248 9.5759C21.8611 9.44477 22.3429 9.44477 22.7808 9.22622C25.2771 8.13347 26.7661 6.0791 27.8171 3.63134C27.9923 3.19424 28.2988 2.62601 27.8171 2.27632C27.3792 1.97035 26.8536 2.27633 26.5033 2.62601C25.5836 3.4565 24.7077 4.28699 23.9194 5.2049C22.8246 6.42878 21.9487 7.87121 21.248 9.5759Z" fill="white"/>
            <path d="M11.6572 3.93729C10.1682 4.19955 8.72302 4.33068 7.36542 4.63665C6.70851 4.76778 4.03708 5.24859 3.51156 4.33068C3.07362 3.71874 3.46776 2.80083 3.51156 2.53857C3.59914 2.10147 3.55535 1.62066 3.68673 1.22727C3.81811 0.87759 4.12467 0.83388 4.47502 0.96501C4.86917 1.13985 5.3071 1.3584 5.70125 1.40211C8.76682 1.62066 11.8324 1.57695 14.8542 0.96501C14.898 0.96501 14.9855 0.9213 15.0293 0.9213C16.3432 0.61533 16.6497 0.74646 17.3066 1.97034C17.4818 2.32002 17.6132 2.6697 17.657 3.01938C17.7008 3.23793 17.5694 3.58761 17.3504 3.71874C13.5841 6.73473 10.0368 10.1004 6.48954 13.4224C6.31436 13.5972 6.09539 13.7283 5.87642 13.9032C5.92022 13.9469 5.96401 13.9469 6.00781 13.9906C6.66471 13.9906 7.32162 13.9469 8.02232 13.9906C8.98579 14.0343 9.99305 14.078 10.9565 14.2091C12.1389 14.4277 13.0148 15.5642 13.0148 16.7006C13.0148 17.4 12.8396 17.4874 12.2703 17.1814C12.0076 17.0503 11.7448 17.0066 11.4382 17.0066C9.42373 16.8755 7.453 17.2251 5.48228 17.6185C4.78158 17.7497 4.03708 17.9245 3.33638 18.0993C2.76706 18.2305 2.19774 18.1868 1.71601 17.7934C0.796337 17.0503 0.183223 16.1324 0.00804783 14.9522C-0.035746 14.4714 0.0956355 14.078 0.48978 13.6846C3.46776 11.0183 6.40195 8.352 9.37993 5.68569C10.0806 5.11746 10.8689 4.59294 11.6572 3.93729Z" fill="white"/>
          </svg>
        </div>
        <div class="pt-1">
          <div
            v-for="(item, i) in items"
            :key="i"
            class="flex text-lg text-gray-100 pb-6"
          >
            <div class="mr-4">
              <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M7.58947 11.9648L16.8212 21.1965L14.0176 24L4.78595 14.7683L7.58947 11.9648Z" fill="#7E99D0"/>
                <path d="M27.2141 10.8035L14.0176 24L11.2141 21.1965L24.4106 8L27.2141 10.8035Z" fill="#7E99D0"/>
              </svg>
            </div>
            <div v-html="item.text" class="pt-1" />
          </div>
        </div>
      </div>
      <Social class="mb-2 py-6 md:pb-8 lg:pl-20" />
    </div>
    <div class="container relative h-full flex-grow flex flex-col">
      <div class="container absolute top-0 right-0">
        <div class="flex items-center justify-end text-gray-200 lg:pr-20 pt-6 sm:pt-8">
          <span class="pr-1">{{ $t('signup.hasAccount') }}</span>
          <router-link
            :to="{ name: 'signin' }"
            class="text-blue-500 hover:text-blue-600"
          >
            <span>{{ $t('signup.signin') }}</span>
          </router-link>
        </div>
      </div>
      <div class="signup--top w-full max-w-sm flex-grow mx-auto sm:mx-0 lg:ml-24">
        <div class="pb-10 font-semibold text-2xl">Регистрация</div>
        <ZForm
          ref="form"
          v-model="formValidity"
        >
          <ZTextField
            v-model="formModel.firstName"
            :placeholder="$t('signup.firstName')"
            :rules="[rules.required]"
            class="pb-6"
            name="firstName"
            autofocus
          >
          </ZTextField>
          <ZTextField
            v-model="formModel.lastName"
            :placeholder="$t('signup.lastName')"
            :rules="[rules.required]"
            class="pb-6"
            name="lastName"
          >
          </ZTextField>
          <ZTextField
            ref="email"
            v-model="formModel.email"
            :placeholder="$t('signup.login')"
            :rules="[rules.required, rules.email]"
            class="pb-6"
            type="email"
            name="email"
          >
          </ZTextField>
          <ZTextField
            v-model="formModel.password"
            :placeholder="$t('signup.password')"
            :type="showPassword ? 'text' : 'password'"
            :rules="[rules.required, rules.passwordMinLength]"
            class="pb-6"
            name="password"
            minlength="8"
          >
            <template v-slot:append>
              <div
                class="cursor-pointer select-none text-gray-500 hover:text-blue-500"
                @click="showPassword = !showPassword"
              >
                <svg v-if="showPassword" width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M12 4.5C7 4.5 2.73 7.61 1 12C2.73 16.39 7 19.5 12 19.5C17 19.5 21.27 16.39 23 12C21.27 7.61 17 4.5 12 4.5ZM12 17C9.24 17 7 14.76 7 12C7 9.24 9.24 7 12 7C14.76 7 17 9.24 17 12C17 14.76 14.76 17 12 17ZM12 9C10.34 9 9 10.34 9 12C9 13.66 10.34 15 12 15C13.66 15 15 13.66 15 12C15 10.34 13.66 9 12 9Z" fill="currentColor"/>
                </svg>
                <svg  v-else width="24" height="18" viewBox="0 0 24 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M19.3684 3.63488L20.3158 2.68752C21.0526 1.95067 21.1579 1.0033 20.5263 0.371726C19.8947 -0.15459 18.9474 -0.15459 18.2105 0.582252L16.6316 2.1612C15.1579 1.63488 13.6842 1.31909 12.1053 1.31909C6.84211 1.31909 2.21053 4.37173 0 8.89804C1.05263 11.0033 2.63158 12.898 4.63158 14.1612L3.47368 15.2138C2.73684 15.9507 2.63158 16.898 3.26316 17.5296C3.89474 18.0559 4.84211 18.0559 5.57895 17.3191L7.26316 15.6349C7.26316 15.6349 7.26316 15.6349 7.36842 15.6349L9.05263 13.8454L17.7895 5.10857L19.3684 3.63488ZM6.10526 12.6875C6.10526 12.6875 6 12.6875 6 12.5823C4.63158 11.5296 3.36842 10.3717 2.42105 8.89804C3.36842 7.52962 4.52632 6.26646 6 5.3191C6.10526 5.21383 6.21053 5.21383 6.31579 5.10857C9.47368 3.0033 12.6316 3.21383 14.8421 3.84541L6.10526 12.6875Z" fill="currentColor"/>
                  <path d="M21.6842 5.63489L20.1052 7.21384C20.6316 7.74015 21.1579 8.37173 21.4737 8.89805C20.5263 10.2665 19.3684 11.5296 17.8947 12.477C16.421 13.4244 14.7368 13.9507 13.0526 14.0559L10.7368 16.3717C11.1579 16.3717 11.5789 16.477 11.8947 16.477C17.1579 16.477 21.7894 13.4244 24 8.89805C23.3684 7.74015 22.6316 6.68752 21.6842 5.63489Z" fill="currentColor"/>
                </svg>
              </div>
            </template>
          </ZTextField>
          <Checkbox
            :rules="[rules.required]"
            class="pb-12"
          >
            <span class="ml-3 float-left">
              {{ $t('signup.acceptPolicyAndTerms') }}&nbsp;
              <a class="text-blue-500 hover:text-blue-600" href="#">{{ $t('signup.privacyPolicy') }}</a>
              &nbsp;{{ $t('preposition.and') }}&nbsp;
              <a class="text-blue-500 hover:text-blue-600" href="#">{{ $t('signup.termsOfUse') }}</a>
            </span>
          </Checkbox>
        </ZForm>
        <ZButton
          :disabled="formValidity"
          :loading="loading"
          class="w-full sm:w-48"
          @click="onSubmit"
        >
          Зарегистрироваться
        </ZButton>
      </div>
      <div class="py-5 md:pb-8 lg:pl-24">
        <Social class="sm:hidden justify-center mb-1 pb-6" />
        <Copyright class="mx-auto text-center sm:text-left sm:mx-0" />
      </div>
    </div>
  </div>
</template>

<script>
import Social from '@/components/Social.vue'
import Copyright from '@/components/Copyright.vue'

export default {
  name: 'SignUp',
  components: {
    Social,
    Copyright,
  },
  data () {
    return {
      items: [
        { text: 'Не&nbsp;требует обучения' },
        { text: 'Облачные технологии' },
        { text: 'Международные документы<br>в пару кликов' },
        { text: 'Мультиязычность' },
      ],
      frontendVersion: process.env.FRONTEND_VERSION || '',
      formValidity: false,
      loading: false,
      errorMessage: '',
      showPassword: false,
      formModel: {
        firstName: '',
        lastName: '',
        email: '',
        password: '',
      },
      rules: {
        required: v => !!v || this.$t('rule.required'),
        email: v => /.+@.+\..+/.test(v) || this.$t('rule.email'),
        passwordMinLength: v => (v && v.length > 7) || this.$t('rule.minLength', { n: 8 }),
      },
    }
  },
  methods: {
    async onSubmit (e) {
      try {
        e.preventDefault()
        this.loading = true
        this.errorMessage = ''
        const isValid = this.$refs.form.validate()
        if (isValid) {
          const { firstName, lastName, email, password } = this.formModel
          const response = await this.$Auth.signUp(
            email,
            password,
            {
              family_name: lastName,
              given_name: firstName,
              email,
              locale: this.$i18n.locale,
            },
          )
          this.$logger.info('Registered user', response.user)
          const username = response.user && response.user.username
          // set username to sessionStorage and check on Welcome page mounted
          // moved from on apollo cache, removed on page reload
          sessionStorage.setItem('Cognito-registered-username', username)
          this.$router.push({ name: 'welcome' })
        }
      } catch (error) {
        this.errorMessage = error.message || error
        this.$logger.warn('Error: ', error)
      } finally {
        this.loading = false
      }
    },
  },
}
</script>

<style lang="postcss" scoped>
.signup--top {
  padding-top: 10vh;
}
@screen sm {
 .signup--top {
    padding-top: 15vh;
  }
}
@screen lg {
 .signup--top {
    padding-top: 20vh;
  }
}
@screen xl {
 .signup--top {
    padding-top: 25vh;
  }
}
</style>
